{{!-- Define some reusable in-line blocks before the actual main content --}}
{{#*inline "blockForFRR"}}
{{#if name}}
### {{name}}
{{else}}
### {{@key}}
{{/if}}

{{#if updated}}  
??? abstract "{{@key}}"

    {{#if fka}}**Former ID:** {{fka}}{{/if}}

    **Changelog:**

    {{#each updated}}
    - **{{this.date}}:** {{this.comment}}
      {{#if this.prev}}
      
        **Was:** {{this.prev}}
      {{/if}}
    {{/each}}
{{else}}
!!! abstract "{{@key}}"
{{/if}}

!!! quote ""


{{#if varies_by_level}}
  {{#each varies_by_level}}
    === "{{ucfirst @key}}"
        {{this.statement}}

        {{#if this.pain_timeframes}}
        
        | Potential Adverse Impact | LEV + IRV | LEV + NIRV | NLEV |
        |-------------------------|-----------|------------|------|
          {{#each pain_timeframes}}
        | N{{this.pain}} | {{this.max_days_irv_lev}}|{{this.max_days_nirv_lev}} | {{this.max_days_nlev}}|
          {{/each}}
        {{/if}}

  {{/each}}      
{{else}}
    {{statement}}
  {{#if following_information}}
    {{#each following_information}}

    1. {{this}}
    {{/each}}
  {{/if}}
  {{#if following_information_bullets}}
    {{#each following_information_bullets}}

    - {{this}}
    {{/each}}
  {{/if}}
{{/if}}
{{#if note}}

    ---

    _**Note:** {{note}}_
{{/if}}
{{#if notes}}

    ---

    _**Notes:**_

  {{#each notes}}
    - _{{this}}_
  {{/each}}
{{/if}}
{{#if controls}}

    **Related SP 800-53 Controls:** {{#each controls}}[{{ uppercase this }}]({{controlfreak this}}){{#unless @last}}, {{/unless}}{{/each}}
{{/if}}
{{#if reference}}

    **Reference:** [{{reference}}]({{reference_url}})
{{/if}}
{{#if this.examples}}
          {{#each this.examples}}

    ??? tip "{{this.id}}"

        **Key Tests:**

          {{#each this.key_tests}}
        - {{this}}
          {{/each}}

        **Examples:**

          {{#each this.examples}}
        - {{this}}
          {{/each}}          
          {{/each}}
        {{/if}}

{{#if terms}}

    ---

    **Terms:** {{#each terms}}[{{this}}](fedramp-definitions/#{{termlink this}}){ data-preview }{{#unless @last}}, {{/unless}}{{/each}}
{{/if}}

{{/inline}}
{{!-- ######################################################################## --}}
{{!-- ######################################################################## --}}
{{!-- ######################################################################## --}}
{{!-- ######################################################################## --}}
{{!-- ######################################################################## --}}
{{!-- ######################################################################## --}}
{{!-- START KSI TEMPLATE CONTENT --}}
{{#if (stringEquals type "KSI")}}
# {{name}}

!!! info ""

    {{theme}}

{{#each indicators}}

{{> blockForFRR}}

{{/each}}
{{else}}
{{!-- ######################################################################## --}}
{{!-- START MAIN TEMPLATE CONTENT --}}
# {{info.name}}

{{#if (stringEquals version "20x")}}
!!! info "Effective Date(s) & Overall Applicability for 20x"
      - **{{ucfirst info.effective.20x.is}}** ({{info.effective.20x.current_status}})
      {{#each info.effective.20x.comments}}
      - {{this}}
      {{/each}}
{{/if}}

{{#if (stringEquals version "rev5")}}
!!! info "Effective Date(s) & Overall Applicability for Rev5"
      - **{{ucfirst info.effective.rev5.is}}** ({{info.effective.rev5.current_status}}) beginning {{info.effective.rev5.start_date}}.
      {{#each info.effective.rev5.comments}}
      - {{this}}
      {{/each}}
      
      {{#if info.effective.rev5.signup_url}}
      - **Sign-up Form:** [{{info.effective.rev5.signup_url}}]({{info.effective.rev5.signup_url}})
      {{/if}}

  {{#if info.effective.rev5.warnings}}
!!! danger "Mandatory Adoption for Rev5"
    {{#each info.effective.rev5.warnings}}
    - {{this}}
    {{/each}}
  {{/if}}
{{/if}}

??? abstract "Background & Authority"
{{#each info.front_matter.authority}}
    - [{{reference}}]({{reference_url}}) {{description}}
{{/each}}

{{info.front_matter.purpose}}

---
{{!-- ######################################################################## --}}
{{!-- ######################################################################## --}}
{{!-- Requirements section (FRR) --}}
{{#if (stringEquals type "FRR")}}

{{#if (stringEquals version "rev5")}}
{{#if data.rev5}}
  {{#each data.rev5}}
    {{#with (lookup ../info.labels @key) as | labels |}}
## {{labels.name}}

{{labels.description}}

    {{/with}}
    {{#each this}}
{{> blockForFRR}}
    {{/each}}
  {{/each}}
{{/if}}
{{/if}}

{{#if (stringEquals version "20x")}}
{{#if data.20x}}
  {{#each data.20x}}
    {{#with (lookup ../info.labels @key) as | labels |}}
## {{labels.name}}

{{labels.description}} 

    {{/with}}
    {{#each this}}
{{> blockForFRR}}
    {{/each}}
  {{/each}}  
{{/if}}
{{/if}}

{{#if data.both}}
  {{#each data.both}}

---

    {{#with (lookup ../info.labels @key) as | labels |}}
## {{labels.name}}

{{labels.description}}

    {{/with}}
    {{#each this}}
{{> blockForFRR}}
    {{/each}}
  {{/each}}
{{/if}}
{{/if}}


{{!-- ######################################################################## --}}
{{!-- begin KSI block --}}
{{#if (stringEquals info.short_name "KSI")}}

---
## Key Security Indicator Themes

!!! info ""
   
    Key Security Indicators (KSIs) apply to all cloud service offerings seeking a 
    FedRAMP 20x Validation; each KSI must be addressed as specified in the KSI
    requirements and recommendations above.

    Key Security Indicators are grouped into themes for ease of review. Each theme
    is displayed on a separate page to simplify transition between themes and
    finding specific KSIs.

{{#if ksiInfo}}{{#each ksiInfo}}
### [{{name}}]({{web_name}}/)

!!! quote ""

    {{description}}

{{/each}}{{/if}}

{{/if}}
{{!-- end KSI block --}}
{{!-- ######################################################################## --}}
{{!-- ending FRR --}}
{{!-- ######################################################################## --}}
{{!-- ######################################################################## --}}
{{!-- Definitions section (FRD) --}}
{{#if (stringEquals type "FRD")}}

{{#if data.both}}
  {{#each data.both}}
### {{term}}

{{#if updated}}  
??? abstract "**ID:** {{@key}}"

    {{#if fka}}**Former ID:** {{fka}}{{/if}}
      
    **Changelog:**

    {{#each updated}}
    - **{{this.date}}:** {{this.comment}}
      {{#if this.prev}}
      
        **Was:** {{this.prev}}
      {{/if}}
    {{/each}}
{{else}}
!!! abstract "**ID:** {{@key}}"
{{/if}}



!!! quote ""
    {{definition}}

    ---

      {{#if note}}

    _**Note:** {{note}}_
      {{/if}}
      {{#if notes}}

    _**Notes:**_
        {{#each notes}}

    - _{{this}}_
        {{/each}}
      {{/if}}      
      {{#if reference}}
    **Reference:** [{{reference}}]({{reference_url}})
{{/if}}
{{#if alts}}

    **Also:** {{#each alts}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
{{/if}}
  {{/each}}
{{/if}}
{{/if}}
{{/if}}
{{!-- end FRR and FRD block from if KSI start --}}