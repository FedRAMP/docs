<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Basic JSON Editor Example</title>
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/css/jsoneditor.min.css"></script>
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/spectre.css@latest/dist/spectre-exp.min.css"></script>
    <script src="https://cdn.jsdelivr.net/npm/spectre.css@latest/dist/spectre-icons.min.css"></script>
    <script src="https://cdn.jsdelivr.net/npm/spectre.css@latest/dist/spectre.min.css"></script>
</head>
<body>
<h1>Basic JSON Editor Example</h1>
<div id="editor"></div>

<script>
    const params = new URLSearchParams(window.location.search);
    const schemaUrl = params.get('schema') || 'https://raw.githubusercontent.com/FedRAMP/docs/refs/heads/main/tools/templates/FedRAMP.schema.json';

    const dataUrl = "https://raw.githubusercontent.com/FedRAMP/docs/refs/heads/main/data/" + params.get('data');
    const editor = document.getElementById('editor');

    const schemaPromise = fetch(schemaUrl).then(response => response.json());
    const dataPromise = dataUrl ? fetch(dataUrl).then(response => response.json()) : Promise.resolve(null);

    Promise.all([schemaPromise, dataPromise])
        .then(([schema, data]) => {
            const options = {
                schema: schema,
                theme: 'spectre',
                iconlib: 'spectre',
                ajax: true
            };
            if (data) {
                options.startval = data;
            }
            const jseditor = new JSONEditor(editor, options);

    jseditor.on('ready', function () {
        let button = jseditor.root.getButton('Save Result As File', 'save', 'Save Result As File'),
            button_holder = jseditor.root.theme.getHeaderButtonHolder();
        button_holder.appendChild(button);
        jseditor.root.header.parentNode.insertBefore(button_holder, jseditor.root.header.nextSibling);

        button.addEventListener('click', function (e) {
            e.preventDefault();
            var example = jseditor.getValue(),
                filename = 'example.json',
                blob = new Blob([JSON.stringify(example, null, 2)], {
                    type: "application/json;charset=utf-8"
                });

            if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                window.navigator.msSaveOrOpenBlob(blob, filename);
            } else {
                var a = document.createElement('a');
                a.download = filename;
                a.href = URL.createObjectURL(blob);
                a.dataset.downloadurl = ['text/plain', a.download, a.href].join(':');

                a.dispatchEvent(new MouseEvent('click', {
                    'view': window,
                    'bubbles': true,
                    'cancelable': false
                }));
            }
        }, false);
    });
    }
    )
    ;


</script>
</body>
</html>
